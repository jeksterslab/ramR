---
title: "Test: Two-Variable Linear Regression"
author: "Ivan Jacob Agaloos Pesigan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Test: Two-Variable Linear Regression}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r include = FALSE}
knitr::opts_chunk$set(
  error = TRUE,
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
```




```{r }
library(testthat)
library(ramR)
library(Ryacas)
```



```{r parameters}
alpha <- runif(n = 1, min = -1, max = 1)
beta <- runif(n = 1, min = -1, max = 1)
sigma2x <- runif(n = 1, min = 0, max = 1)
sigma2epsilon <- runif(n = 1, min = 0, max = 1)
mux <- runif(n = 1, min = -1, max = 1)
muepsilon <- 0
A <- S <- matrixR::zeroes(3, 3)
A[1, ] <- c(0, beta, 1)
diag(S) <- c(0, sigma2x, sigma2epsilon)
colnames(A) <- rownames(A) <- c("y", "x", "e")
I <- matrixR::ones_from(A)
IminusA <- I - A
E <- as_r(solve(ysym(I) - ysym(A)))
filter <- diag(2)
filter <- cbind(filter, 0)
colnames(filter) <- c("y", "x", "e")
rownames(filter) <- c("y", "x")
u <- as.matrix(c(alpha, mux, 0))
v <- as.matrix(c(alpha + (beta * mux), mux, 0.00))
rownames(u) <- rownames(v) <- c("y", "x", "e")
colnames(u) <- "u"
colnames(v) <- "v"
C <- as_r(solve(ysym(I) - ysym(A)) * ysym(S) * t(solve(ysym(I) - ysym(A))))
M <- as_r(ysym(filter) * solve(ysym(I) - ysym(A)) * ysym(S) * t(solve(ysym(I) - ysym(A))) * t(ysym(filter)))
g <- as.matrix(as_r(ysym(filter) * ysym(v)))
```


\begin{equation}
  \begin{split}
    y &= \alpha + \beta x + \varepsilon \\
    y &= `r alpha` + `r beta` x + \varepsilon
  \end{split}
\end{equation}


```{r numeric}
ram_num <- ram_num(A, S, u, filter)
results_ram_num_C <- round(ram_num$C, digits = 4)
results_ram_num_M <- round(ram_num$M, digits = 4)
results_ram_num_v <- round(ram_num$v, digits = 4)
results_ram_num_g <- round(ram_num$g, digits = 4)
results_C_num <- round(C_num(A, S), digits = 4)
results_E_num <- round(E_num(A), digits = 4)
results_IminusA_num <- round(IminusA_num(A), digits = 4)
results_M_num <- round(M_num(A, S, filter), digits = 4)
results_S_num <- round(S_num(A, C), digits = 4)
results_v_num <- round(v_num(A, u), digits = 4)
results_u_num <- round(u_num(A, v), digits = 4)
results_g_num <- round(g_num(A, u, filter), digits = 4)
ram2dat <- ram2dat(n = 1000, A, S, u, filter, empirical = TRUE)
Sigma.ram2dat <- round(cov(ram2dat), digits = 4)
mu.ram2dat <- as.matrix(round(colMeans(ram2dat), digits = 4))
eq <- paste(
  "e by y", 1, ";",
  "y on x", beta, ";",
  "e with e", sigma2epsilon, ";",
  "x with x", sigma2x, ";",
  "y on 1", alpha, ";",
  "x on 1", mux, ";"
)
eq2dat <- eq2dat(eq, n = 1000, empirical = TRUE)
Sigma.eq2dat <- round(cov(eq2dat), digits = 4)
mu.eq2dat <- as.matrix(round(colMeans(eq2dat), digits = 4))
eq2exp_num <- eq2exp_num(eq)
results_eq2exp_num_C <- round(eq2exp_num$C, digits = 4)
results_eq2exp_num_M <- round(eq2exp_num$M, digits = 4)
results_eq2exp_num_v <- round(eq2exp_num$v, digits = 4)
results_eq2exp_num_g <- round(eq2exp_num$g, digits = 4)
```



```{r symbolic}
ram_sym <- ram_sym(A, S, u, filter, simplify = TRUE)
results_ram_sym_C <- round(as_r(ram_sym$C), digits = 4)
results_ram_sym_M <- round(as_r(ram_sym$M), digits = 4)
results_ram_sym_v <- round(as_r(ram_sym$v), digits = 4)
results_ram_sym_g <- round(as_r(ram_sym$g), digits = 4)
results_C_sym <- round(as_r(C_sym(A, S, simplify = TRUE)), digits = 4)
results_E_sym <- round(as_r(E_sym(A, simplify = TRUE)), digits = 4)
results_IminusA_sym <- round(as_r(IminusA_sym(A, simplify = TRUE)), digits = 4)
results_M_sym <- round(as_r(M_sym(A, S, filter, simplify = TRUE)), digits = 4)
results_S_sym <- round(as_r(S_sym(A, C, simplify = TRUE)), digits = 4)
results_v_sym <- round(as_r(v_sym(A, u, simplify = TRUE)), digits = 4)
results_u_sym <- round(as_r(u_sym(A, v, simplify = TRUE)), digits = 4)
results_g_sym <- round(as_r(g_sym(A, u, filter, simplify = TRUE)), digits = 4)
eq2exp_sym <- eq2exp_sym(eq, simplify = TRUE)
results_eq2exp_sym_C <- round(as_r(eq2exp_sym$C), digits = 4)
results_eq2exp_sym_M <- round(as_r(eq2exp_sym$M), digits = 4)
results_eq2exp_sym_v <- round(as_r(eq2exp_sym$v), digits = 4)
results_eq2exp_sym_g <- round(as_r(eq2exp_sym$g), digits = 4)
```



```{r round_source}
C <- round(C, digits = 4)
E <- round(E, digits = 4)
IminusA <- round(IminusA, digits = 4)
M <- round(M, digits = 4)
S <- round(S, digits = 4)
v <- round(v, digits = 4)
u <- round(u, digits = 4)
g <- round(g, digits = 4)
```



```{r testthat}
test_that("C.", {
  for (i in seq_len(nrow(C))) {
    for (j in seq_len(ncol(C))) {
      expect_equal(
        C[i, j],
        results_C_num[i, j],
        results_C_sym[i, j],
        results_ram_num_C[i, j],
        results_ram_sym_C[i, j],
        results_eq2exp_num_C[i, j],
        results_eq2exp_sym_C[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("E.", {
  for (i in seq_len(nrow(E))) {
    for (j in seq_len(ncol(E))) {
      expect_equal(
        E[i, j],
        results_E_num[i, j],
        results_E_sym[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("IminusA.", {
  for (i in seq_len(nrow(IminusA))) {
    for (j in seq_len(ncol(IminusA))) {
      expect_equal(
        IminusA[i, j],
        results_IminusA_num[i, j],
        results_IminusA_sym[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("M.", {
  for (i in seq_len(nrow(M))) {
    for (j in seq_len(ncol(M))) {
      expect_equal(
        M[i, j],
        Sigma.ram2dat[i, j],
        Sigma.eq2dat[i, j],
        results_M_num[i, j],
        results_M_sym[i, j],
        results_ram_num_M[i, j],
        results_ram_sym_M[i, j],
        results_eq2exp_num_M[i, j],
        results_eq2exp_sym_M[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("S.", {
  for (i in seq_len(nrow(S))) {
    for (j in seq_len(ncol(S))) {
      expect_equal(
        S[i, j],
        results_S_num[i, j],
        results_S_sym[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("v.", {
  for (i in seq_len(nrow(v))) {
    for (j in seq_len(ncol(v))) {
      expect_equal(
        v[i, j],
        results_v_num[i, j],
        results_v_sym[i, j],
        results_ram_num_v[i, j],
        results_ram_sym_v[i, j],
        results_eq2exp_num_v[i, j],
        results_eq2exp_sym_v[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("u.", {
  for (i in seq_len(nrow(u))) {
    for (j in seq_len(ncol(u))) {
      expect_equal(
        u[i, j],
        results_u_num[i, j],
        results_u_sym[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("g.", {
  for (i in seq_len(nrow(g))) {
    for (j in seq_len(ncol(g))) {
      expect_equal(
        g[i, j],
        mu.ram2dat[i, j],
        mu.eq2dat[i, j],
        results_g_num[i, j],
        results_g_sym[i, j],
        results_ram_num_g[i, j],
        results_ram_sym_g[i, j],
        results_eq2exp_num_g[i, j],
        results_eq2exp_sym_g[i, j],
        check.attributes = FALSE
      )
    }
  }
})
```



```{r coverage}
ram_num(A, S, u = NULL, filter)
ram_sym(A, S, u = NULL, filter)
```



```{r eq2ram}
A <- S <- matrix(
  data = 0,
  nrow = 3,
  ncol = 3
)
A[1, 2] <- "beta"
A[1, 3] <- 1
diag(S) <- c(0, "sigma[x]^2", "sigma[varepsilon]^2")
filter <- diag(2)
filter <- cbind(filter, 0)
u <- as.matrix(c("alpha", "mu[x]", 0))
eq <- "
  # VARIABLE1 OPERATION VARIABLE2 LABEL
  e           by        y         1;
  y           on        x         beta;
  e           with      e         sigma[varepsilon]^2;
  x           with      x         sigma[x]^2;
  y           on        1         alpha;
  x           on        1         mu[x]
"
RAM <- eq2ram(eq)
results_A <- RAM$A
results_S <- RAM$S
results_filter <- RAM$filter
results_u <- RAM$u
test_that("A.", {
  for (i in seq_len(nrow(A))) {
    for (j in seq_len(ncol(A))) {
      expect_equal(
        A[i, j],
        results_A[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("S.", {
  for (i in seq_len(nrow(S))) {
    for (j in seq_len(ncol(S))) {
      expect_equal(
        S[i, j],
        results_S[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("filter.", {
  for (i in seq_len(nrow(filter))) {
    for (j in seq_len(ncol(filter))) {
      expect_equal(
        filter[i, j],
        results_filter[i, j],
        check.attributes = FALSE
      )
    }
  }
})
test_that("u.", {
  for (i in seq_len(nrow(u))) {
    for (j in seq_len(ncol(u))) {
      expect_equal(
        u[i, j],
        results_u[i, j],
        check.attributes = FALSE
      )
    }
  }
})
```

